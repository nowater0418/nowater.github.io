<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新加坡PSI数据表格</title>
    <!-- 引入D3.js库（使用CDN，无需本地下载） -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* 简单样式优化表格可读性 */
        table { border-collapse: collapse; width: 80%; margin: 20px auto; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tr:hover { background-color: #f9f9f9; }
        .loading { text-align: center; margin-top: 50px; font-size: 18px; color: #666; }
    </style>
</head>
<body>
    <div class="loading">正在加载PSI数据...</div>
    <div id="table-container"></div>

    <script>
        // 1. 调用新加坡PSI数据API
        d3.json("https://api.data.gov.sg/v1/environment/psi")
            .then(data => {
                // 隐藏加载提示
                document.querySelector(".loading").style.display = "none";

                // 2. 提取核心数据（取最新时间节点的24小时PSI值）
                const latestData = data.items[0]; // API返回的最新数据项
                const timestamp = latestData.timestamp; // 数据时间戳
                const psiReadings = latestData.readings.psi_twenty_four_hourly; // 各区域24小时PSI值

                // 3. 整理表格数据格式（每行包含：时间、区域、PSI值）
                const tableData = Object.entries(psiReadings).map(([region, value]) => ({
                    time: timestamp,
                    region: region.replace("_", " "), // 优化区域名显示（如north_east→north east）
                    psi: value
                }));

                // 4. 用D3创建表格
                const table = d3.select("#table-container")
                    .append("table");

                // 表头
                const thead = table.append("thead")
                    .append("tr");
                thead.selectAll("th")
                    .data(["数据时间", "区域", "24小时PSI值"]) // 表头文本
                    .enter()
                    .append("th")
                    .text(d => d);

                // 表格内容
                const tbody = table.append("tbody");
                tbody.selectAll("tr")
                    .data(tableData)
                    .enter()
                    .append("tr")
                    .selectAll("td")
                    .data(d => [d.time, d.region, d.psi]) // 每行对应的3列数据
                    .enter()
                    .append("td")
                    .text(d => d);
            })
            .catch(error => {
                // 加载失败提示
                document.querySelector(".loading").textContent = "数据加载失败，请刷新重试";
                console.error("API请求错误：", error);
            });
    </script>
</body>
</html>
